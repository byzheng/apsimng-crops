---
title: ""
params:
  crop: "{{crop}}"
---

```{r setup, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, error = FALSE, message = FALSE)

if (!exists("params") || grepl("\\{", params$crop)) {
    crop <- "Wheat"
    cultivar <- "All"
} else {
    crop <- params[["crop"]]
    cultivar <- params[["cultivar"]]
}
crop_data_dir <- "_data/_outputs"

```


```{r data-obs-sim}

# Read the obs/prediction files
file_path <- file.path(crop_data_dir, paste0(crop, ".Rds")) |> 
    here::here()
message("Reading cached output: ", file_path)
obs_sim_cultivar <- readRDS(file_path)
apsimx <- get_model(crop)
cultivars <- rapsimng::get_cultivar(apsimx, alias = TRUE) |> tibble::tibble()
experiments <- obs_sim_cultivar |> 
    dplyr::distinct(ExperimentName, Latitude, Longitude)
```

## Cultivars



```{r list-cultivar}
files <- list.files("cultivar", "*.qmd", full.names = TRUE, recursive = TRUE)

tbl <- data.frame(
    Cultivar = tools::file_path_sans_ext(basename(files)),
    Link = paste0(
        "<a href='", gsub("qmd", "html", files), "'>",
        tools::file_path_sans_ext(basename(files)),
        "</a>"
    ),
    stringsAsFactors = FALSE
)

DT::datatable(
    tbl["Link"],
    colnames = "Cultivar",
    escape = FALSE,
    rownames = FALSE,
    options = list(
        pageLength = 50,
        lengthMenu = c(25, 50, 100),
        order = list(list(0, "asc"))
    )
)
```

## Performance Overview


{{< include /_template/cultivar_with_data.qmd >}}